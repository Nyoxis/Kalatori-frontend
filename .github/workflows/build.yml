name: Build opencart3 and prestashop modules
on: workflow_dispatch
jobs:
  build-prestashop-addon:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    defaults:
      run:
        working-directory: ./prestashop_release
    steps:
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Get Tag
        run: echo "TAG=$(date +'%Y-%m-%d')_$(git rev-parse --short "$GITHUB_SHA")" >> $GITHUB_ENV
      - name: Get filename
        run: echo "ZIP=ps_dotpayment_$TAG.zip" >> $GITHUB_ENV
      - name: Run make_zip script file
        run: ./make_zip.php $ZIP
      - name: release
        run: gh release create $TAG "$ZIP" --generate-notes

